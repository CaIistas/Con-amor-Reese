<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Con amor, Reese</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Permíteme desmostrarte mi amor de la forma que sé" />
  <meta name="keywords" content="Alaska, amor, novia, te amo, Reese, de Reese para Alaska" />
  <link rel="stylesheet" href="assets/styles/styles.css" />
  <link rel="icon" type="image/png" href="assets/img/gatito.jpg" />
  <link href="https://fonts.googleapis.com/css2?family=Palanquin+Dark&family=Lato&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

  <div id="pantalla-inicio" class="pantalla-inicio">
    <h1>Con amor, Reese</h1>
    <button id="btn-iniciar">Iniciar</button>
  </div>

  <div id="escena" class="escena" style="display:none;">
    <div class="personaje-wrapper">
      <img id="personaje" src="assets/img/personaje-feliz.png" alt="Personaje" />
    </div>

    <div class="dialogo-container">
      <div id="dialogo" class="dialogo-burbuja">Cargando...</div>
      <div id="opciones-container"></div>
      <button id="btn-siguiente" onclick="mostrarSiguienteDialogo()">Siguiente</button>
    </div>
  </div>

  <script>
    const dialogos = [
      { texto: "¡Hola, Alaska! ¿Te gusta lo que hice para ti?", expresion: "feliz", opciones: [] },
      { texto: "Realmente quería hacer algo significativo para ti, que logre expresar lo que siento...", expresion: "seria", opciones: [] },
      { texto: "Y qué mejor que hacerlo con algo que me caracteriza, ¿no?", expresion: "feliz", opciones: [] },
      { texto: "Espero que disfrutes esto, sino, voy a llorar cien años", expresion: "triste", opciones: [] },
      {
        texto: "¿Estás lista?", expresion: "feliz", opciones: [
          { texto: "Sí, estoy lista", siguiente: 8 },
          { texto: "No estoy segura", siguiente: 5 }
        ]
      },
      {
        texto: "¿Segura que no estás lista?", expresion: "seria", opciones: [
          { texto: "Es joda, si estoy lista", siguiente: 8 },
          { texto: "Déjame, gorda, no estoy lista", siguiente: 6 }
        ]
      },
      {
        texto: "Pero yo quiero enseñarte lo que preparé, amor", expresion: "triste", opciones: [
          { texto: "Dale, deja de llorar, tontita", siguiente: 7 }
        ]
      },
      { texto: "Bue, es que te pones pesada...", expresion: "enojada", opciones: [] },
      { texto: "Entonces sigamos con lo que estábamos", expresion: "enamorada", opciones: [] },
      { texto: "Espero te guste", expresion: "normal", opciones: [] }
    ];

    let indiceDialogo = 0;

    // Carga el sonido, lo dejamos fuera para no cargar en cada letra
    const sonido = new Audio('assets/sounds/Hola-alaska.wav');
    sonido.volume = 0.12; // volumen bajo para que no moleste

    function cambiarExpresion(expresion) {
      const personaje = document.getElementById('personaje');
      personaje.src = `assets/img/personaje-${expresion}.png`;
    }

    function mostrarDialogo(indice) {
      indiceDialogo = indice;
      const dialogo = dialogos[indice];
      const divDialogo = document.getElementById('dialogo');
      const opcionesCont = document.getElementById('opciones-container');
      const btnSiguiente = document.getElementById('btn-siguiente');

      cambiarExpresion(dialogo.expresion);
      opcionesCont.innerHTML = '';
      divDialogo.textContent = '';
      btnSiguiente.style.display = 'none';

      const texto = dialogo.texto;
      let i = 0;

      function escribirLetra() {
        if (i < texto.length) {
          divDialogo.textContent += texto[i];

          if (texto[i] !== ' ' && i % 2 === 0) {
            // Para evitar errores si el audio está pausado, reiniciamos y reproducimos
            sonido.currentTime = 0;
            sonido.play().catch(() => {}); // ignoramos errores de autoplay bloqueado
          }

          i++;
          setTimeout(escribirLetra, 35);
        } else {
          if (dialogo.opciones.length > 0) {
            dialogo.opciones.forEach(opcion => {
              const btn = document.createElement('button');
              btn.textContent = opcion.texto;
              btn.classList.add('btn', 'btn-outline-danger', 'm-2');
              btn.onclick = () => mostrarDialogo(opcion.siguiente);
              opcionesCont.appendChild(btn);
            });
          } else {
            btnSiguiente.style.display = 'inline-block';
          }
        }
      }

      escribirLetra();
    }

    function mostrarSiguienteDialogo() {
      const siguiente = indiceDialogo + 1;
      if (siguiente < dialogos.length) {
        mostrarDialogo(siguiente);
      } else {
        document.getElementById('btn-siguiente').style.display = 'none';
      }
    }

    document.getElementById('btn-iniciar').addEventListener('click', () => {
      document.getElementById('pantalla-inicio').style.display = 'none';
      document.getElementById('escena').style.display = 'flex';
      mostrarDialogo(0);
    });
  </script>

</body>
</html>